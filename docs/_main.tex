%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% OXFORD THESIS TEMPLATE

% Use this template to produce a standard thesis that meets the Oxford University requirements for DPhil submission
%
% Originally by Keith A. Gillow (gillow@maths.ox.ac.uk), 1997
% Modified by Sam Evans (sam@samuelevansresearch.org), 2007
% Modified by John McManigle (john@oxfordechoes.com), 2015
% Modified by Ulrik Lyngs (ulrik.lyngs@cs.ox.ac.uk), 2018-, for use with R Markdown
%
% Ulrik Lyngs, 25 Nov 2018: Following John McManigle, broad permissions are granted to use, modify, and distribute this software
% as specified in the MIT License included in this distribution's LICENSE file.
%
% John commented this file extensively, so read through to see how to use the various options.  Remember that in LaTeX,
% any line starting with a % is NOT executed.

%%%%% PAGE LAYOUT
% The most common choices should be below.  You can also do other things, like replace "a4paper" with "letterpaper", etc.

% 'twoside' formats for two-sided binding (ie left and right pages have mirror margins; blank pages inserted where needed):
%\documentclass[a4paper,twoside]{templates/ociamthesis}
% Specifying nothing formats for one-sided binding (ie left margin > right margin; no extra blank pages):
%\documentclass[a4paper]{ociamthesis}
% 'nobind' formats for PDF output (ie equal margins, no extra blank pages):
%\documentclass[a4paper,nobind]{templates/ociamthesis}

% As you can see from the line below, oxforddown uses the a4paper size, 
% and passes in the binding option from the YAML header in index.Rmd:
\documentclass[a4paper, nobind]{templates/ociamthesis}


%%%%% ADDING LATEX PACKAGES
% add hyperref package with options from YAML %
\usepackage[pdfpagelabels]{hyperref}
% handle long urls
\usepackage{xurl}
% change the default coloring of links to something sensible
\usepackage{xcolor}
% change the alignment, this one provides better alignment with hyphenation (breaks words)
\usepackage{ragged2e}

\definecolor{mylinkcolor}{RGB}{0,0,139}
\definecolor{myurlcolor}{RGB}{0,0,139}
\definecolor{mycitecolor}{RGB}{0,33,71}

\hypersetup{
  hidelinks,
  colorlinks,
  linktocpage=true,
  linkcolor=mylinkcolor,
  urlcolor=myurlcolor,
  citecolor=mycitecolor
}


% add float package to allow manual control of figure positioning %
\usepackage{float}

% enable strikethrough
\usepackage[normalem]{ulem}

% use soul package for correction highlighting
\usepackage{color, soulutf8}
\definecolor{correctioncolor}{HTML}{CCCCFF}
\sethlcolor{correctioncolor}
\newcommand{\ctext}[3][RGB]{%
  \begingroup
  \definecolor{hlcolor}{#1}{#2}\sethlcolor{hlcolor}%
  \hl{#3}%
  \endgroup
}
% stop soul from freaking out when it sees citation commands
\soulregister\ref7
\soulregister\cite7
\soulregister\citet7
\soulregister\autocite7
\soulregister\textcite7
\soulregister\pageref7

%%%%% FIXING / ADDING THINGS THAT'S SPECIAL TO R MARKDOWN'S USE OF LATEX TEMPLATES
%pandoc unbounded added for pandoc 3.1.2+
\newcommand{\pandocbounded}[1]{#1}
% pandoc puts lists in 'tightlist' command when no space between bullet points in Rmd file,
% so we add this command to the template
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
 
% allow us to include code blocks in shaded environments
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}

% set white space before and after code blocks


\renewenvironment{Shaded}
{
  \vspace{10pt}%
  \begin{snugshade}%
}{%
  \end{snugshade}%
  \vspace{8pt}%
}

% User-included things with header_includes or in_header will appear here
% kableExtra packages will appear here if you use library(kableExtra)
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}


%UL set section header spacing
\usepackage{titlesec}
% 
\titlespacing\subsubsection{0pt}{24pt plus 4pt minus 2pt}{0pt plus 2pt minus 2pt}


%UL set whitespace around verbatim environments
\usepackage{etoolbox}
\makeatletter
\preto{\@verbatim}{\topsep=0pt \partopsep=0pt }
\makeatother


%%%%%%% PAGE HEADERS AND FOOTERS %%%%%%%%%
\usepackage{fancyhdr}
\setlength{\headheight}{15pt}
\fancyhf{} % clear the header and footers
\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter. #1}{\thechapter. #1}}
\renewcommand{\sectionmark}[1]{\markright{\thesection. #1}} 
\renewcommand{\headrulewidth}{0pt}

\fancyhead[LO]{\emph{\leftmark}} 
\fancyhead[RE]{\emph{\rightmark}} 




% UL page number position 
\fancyfoot[C]{\emph{\thepage}} %regular pages
\fancypagestyle{plain}{\fancyhf{}\fancyfoot[C]{\emph{\thepage}}} %chapter pages




%%%%% SELECT YOUR DRAFT OPTIONS
% This adds a "DRAFT" footer to every normal page.  (The first page of each chapter is not a "normal" page.)
\fancyfoot[C]{\emph{DRAFT on \today}}

% IP feb 2021: option to include line numbers in PDF

% for line wrapping in code blocks
\usepackage{fancyvrb}
\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines=true, breakanywhere=true, commandchars=\\\{\}}

% for quotations -- loaded here rather than in ociamthesis.cls, as it needs to
% be loaded after fvextra, otherwise we get a warning message
\usepackage{csquotes}

% This highlights (in blue) corrections marked with (for words) \mccorrect{blah} or (for whole
% paragraphs) \begin{mccorrection} . . . \end{mccorrection}.  This can be useful for sending a PDF of
% your corrected thesis to your examiners for review.  Turn it off, and the blue disappears.
\correctionstrue


%%%%% BIBLIOGRAPHY SETUP
% Note that your bibliography will require some tweaking depending on your department, preferred format, etc.
% If you've not used LaTeX before, I recommend just using pandoc for citations -- this is what's used unless you specific e.g. "citation_package: natbib" in index.Rmd
% If you're already a LaTeX pro and are used to natbib or something, modify as necessary.

% this allows the latex template to handle pandoc citations




% Uncomment this if you want equation numbers per section (2.3.12), instead of per chapter (2.18):
%\numberwithin{equation}{subsection}


%%%%% THESIS / TITLE PAGE INFORMATION
% Everybody needs to complete the following:
\title{\texttt{oxforddown}:\\
An Oxford University Thesis\\
Template for R Markdown}
\author{Pratyush Choudhary}
\college{Indian Institute of Gandhinagar}

% Master's candidates who require the alternate title page (with candidate number and word count)
% must also un-comment and complete the following three lines:

% Uncomment the following line if your degree also includes exams (eg most masters):
%\renewcommand{\submittedtext}{Submitted in partial completion of the}
% Your full degree name.  (But remember that DPhils aren't "in" anything.  They're just DPhils.)
\degree{Master of Technology}

% Term and year of submission, or date if your board requires (eg most masters)
\degreedate{May 2025}


%%%%% YOUR OWN PERSONAL MACROS
% This is a good place to dump your own LaTeX macros as they come up.

% To make text superscripts shortcuts
\renewcommand{\th}{\textsuperscript{th}} % ex: I won 4\th place
\newcommand{\nd}{\textsuperscript{nd}}
\renewcommand{\st}{\textsuperscript{st}}
\newcommand{\rd}{\textsuperscript{rd}}

%%%%% THE ACTUAL DOCUMENT STARTS HERE
\begin{document}

%%%%% CHANGE TO LEFT-ALIGNED
\RaggedRight

%%%%% CHOOSE YOUR LINE SPACING HERE
% This is the official option.  Use it for your submission copy and library copy:
\setlength{\textbaselineskip}{20pt plus2pt}
% This is closer spacing (about 1.5-spaced) that you might prefer for your personal copies:
%\setlength{\textbaselineskip}{18pt plus2pt minus1pt}

% You can set the spacing here for the roman-numbered pages (acknowledgements, table of contents, etc.)
\setlength{\frontmatterbaselineskip}{17pt plus1pt minus1pt}

% UL: You can set the line and paragraph spacing here for the separate abstract page to be handed in to Examination schools
\setlength{\abstractseparatelineskip}{13pt plus1pt minus1pt}
\setlength{\abstractseparateparskip}{0pt plus 1pt}

% UL: You can set the general paragraph spacing here - I've set it to 2pt (was 0) so
% it's less claustrophobic
\setlength{\parskip}{2pt plus 1pt}

%
% Customise title page
%
\def\crest{{\includegraphics[width=5cm]{templates/iitgnlogo.png}}}
\renewcommand{\university}{}
\renewcommand{\submittedtext}{A thesis submitted for the degree of}
\renewcommand{\thesistitlesize}{\fontsize{22pt}{28pt}\selectfont}
\renewcommand{\gapbeforecrest}{25mm}
\renewcommand{\gapaftercrest}{25mm
}


% Leave this line alone; it gets things started for the real document.
\setlength{\baselineskip}{\textbaselineskip}


%%%%% CHOOSE YOUR SECTION NUMBERING DEPTH HERE
% You have two choices.  First, how far down are sections numbered?  (Below that, they're named but
% don't get numbers.)  Second, what level of section appears in the table of contents?  These don't have
% to match: you can have numbered sections that don't show up in the ToC, or unnumbered sections that
% do.  Throughout, 0 = chapter; 1 = section; 2 = subsection; 3 = subsubsection, 4 = paragraph...

% The level that gets a number:
\setcounter{secnumdepth}{2}
% The level that shows up in the ToC:
\setcounter{tocdepth}{1}


%%%%% ABSTRACT SEPARATE
% This is used to create the separate, one-page abstract that you are required to hand into the Exam
% Schools.  You can comment it out to generate a PDF for printing or whatnot.

% JEM: Pages are roman numbered from here, though page numbers are invisible until ToC.  This is in
% keeping with most typesetting conventions.
\begin{romanpages}

% Title page is created here
\maketitle

%%%%% DEDICATION

%%%%% ACKNOWLEDGEMENTS


\begin{acknowledgements}
 	This is where you will normally thank your advisor, colleagues, family and friends, as well as funding and institutional support. In our case, we will give our praises to the people who developed the ideas and tools that allow us to push open science a little step forward by writing plain-text, transparent, and reproducible theses in R Markdown.

 We must be grateful to John Gruber for inventing the original version of Markdown, to John MacFarlane for creating Pandoc (\url{http://pandoc.org}) which converts Markdown to a large number of output formats, and to Yihui Xie for creating \texttt{knitr} which introduced R Markdown as a way of embedding code in Markdown documents, and \texttt{bookdown} which added tools for technical and longer-form writing.

 Special thanks to \href{http://chester.rbind.io}{Chester Ismay}, who created the \texttt{thesisdown} package that helped many a PhD student write their theses in R Markdown. And a very special thanks to John McManigle, whose adaption of Sam Evans' adaptation of Keith Gillow's original maths template for writing an Oxford University DPhil thesis in LaTeX provided the template that I in turn adapted for R Markdown.

 Finally, profuse thanks to JJ Allaire, the founder and CEO of \href{http://rstudio.com}{RStudio}, and Hadley Wickham, the mastermind of the tidyverse without whom we'd all just given up and done data science in Python instead. Thanks for making data science easier, more accessible, and more fun for us all.

 \begin{flushright}
 Ulrik Lyngs \\
 Linacre College, Oxford \\
 2 December 2018
 \end{flushright}
\end{acknowledgements}



%%%%% ABSTRACT


\renewcommand{\abstracttitle}{Abstract}
\begin{abstract}
	This \emph{R Markdown} template is for writing an Oxford University thesis. The template is built using Yihui Xie's \texttt{bookdown} package, with heavy inspiration from Chester Ismay's \texttt{thesisdown} and the \texttt{OxThesis} \LaTeX~template (most recently adapted by John McManigle).

This template's sample content include illustrations of how to write a thesis in R Markdown, and largely follows the structure from \href{https://ulyngs.github.io/rmarkdown-workshop-2019/}{this R Markdown workshop}.

Congratulations for taking a step further into the lands of open, reproducible science by writing your thesis using a tool that allows you to transparently include tables and dynamically generated plots directly from the underlying data. Hip hooray!
\end{abstract}



%%%%% MINI TABLES
% This lays the groundwork for per-chapter, mini tables of contents.  Comment the following line
% (and remove \minitoc from the chapter files) if you don't want this.  Un-comment either of the
% next two lines if you want a per-chapter list of figures or tables.
\dominitoc % include a mini table of contents

% This aligns the bottom of the text of each page.  It generally makes things look better.
\flushbottom

% This is where the whole-document ToC appears:
\tableofcontents

\listoffigures
	\mtcaddchapter
  	% \mtcaddchapter is needed when adding a non-chapter (but chapter-like) entity to avoid confusing minitoc

% Uncomment to generate a list of tables:
\listoftables
  \mtcaddchapter
%%%%% LIST OF ABBREVIATIONS
% This example includes a list of abbreviations.  Look at text/abbreviations.tex to see how that file is
% formatted.  The template can handle any kind of list though, so this might be a good place for a
% glossary, etc.
% First parameter can be changed eg to "Glossary" or something.
% Second parameter is the max length of bold terms.
\begin{mclistof}{List of Abbreviations}{3.2cm}

\item[1-D, 2-D]

One- or two-dimensional, referring \textbf{in this thesis} to spatial dimensions in an image.

\item[Otter]

One of the finest of water mammals.

\item[Hedgehog]

Quite a nice prickly friend.

\end{mclistof} 


% The Roman pages, like the Roman Empire, must come to its inevitable close.
\end{romanpages}

%%%%% CHAPTERS
% Add or remove any chapters you'd like here, by file name (excluding '.tex'):
\flushbottom

% all your chapters and appendices will appear here
\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# this line ensures that tinytex doesn\textquotesingle{}t try to update LaTeX packages on every single knit}
\FunctionTok{options}\NormalTok{(}\AttributeTok{tinytex.tlmgr\_update =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\chapter*{Introduction}\label{introduction}
\addcontentsline{toc}{chapter}{Introduction}

\adjustmtc
\markboth{Introduction}{}

\chapter{Background}\label{background}

\minitoc 

There are digital devices all around us running code written by people. It can be
to handle a simple electric toothbrush's timer, or to move a robot arm for a surgery.
And, all programs are not created equal. Some are mission-critical pieces of code that
may require high levels of scrutiny at each step of creation, lest they fail and
result in disasters - financial or otherwise.

For such a program running on a device, we need to ensure that it ran correctly
(meaning - as intended by the logic of the code).
But just writing good code doesn't save it from other factors that are present while running it.
There are a few factors that may influence the program to not behave correctly:{[}?? CITEME{]}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  A bug in the code that slipped past the review process.
\item
  There's a flaw in the device that the code is running on.
\item
  A malicious actor attacks the device/program to modify the execution.
\item
  The device's environment is adversarial. Eg. A nuclear plant's control panel.
\end{enumerate}

\sethlcolor{pink}\hl{define control flow}\sethlcolor{correctioncolor}

For factors 1-2, there are techniques like testing, fuzzing, \sethlcolor{pink}\hl{formal verification \ldots{}}\sethlcolor{correctioncolor}
that try to minimize the software/hardware bugs. \sethlcolor{pink}\hl{extend this \ldots{}}\sethlcolor{correctioncolor}

For factor 3, there are various types of attacks that are possible ranging from
Denial of Service to Information Leak.
Our focus is on preventing the control flow of the program to not change,
and for that, the techniques come under the term Control Flow Integrity (CFI).{[}?? sok{]}

But what if the adversary is the device's environment like factor 4?
Or what do we do about the fact that we still cannot guarantee that the program is secure?
\sethlcolor{pink}\hl{As stated by Anon: security is an arms race, no system is fully secure.}\sethlcolor{correctioncolor}\href{}{??}
We need to at-least be able to prove in some way that the program behaved as intended.

For simple programs that process an input to give a deterministic output like
counting prime numbers or calculators, it is easy to just verify the output.
But for non-deterministic or complex programs with side-effects (changes to the
system or device - like writing to a file, or moving a robot arm), verifying the
output is not feasible. \sethlcolor{pink}\hl{One way is to instrument the system to check that the
control flow of the program is as expected, which in turn may indicate
that the program ran correctly.}\sethlcolor{correctioncolor}
And for this instrumentation, the set of techniques is called Control Flow
Attestation (CFA).

\section{Control Flow Techniques}\label{control-flow-techniques}

Let us now look at both CFI and CFA techniques in detail to know their aims and the current
capabilities \sethlcolor{pink}\hl{afforded to us by them.}\sethlcolor{correctioncolor}

\subsection{CFI}\label{cfi}

\subsubsection{What/Why?}\label{whatwhy}

\subsubsection{History and Techniques used}\label{history-and-techniques-used}

\paragraph{Various (3/4) types of attacks possible and their mitigations}\label{various-34-types-of-attacks-possible-and-their-mitigations}

\begin{itemize}
\tightlist
\item
  Code injection
\item
  Code Reuse (ROP/JOP)
\item
  Data Manipulation
\item
  Side channels
\item
  \ldots{}
\end{itemize}

\sethlcolor{pink}\hl{PAC + BTI discussed in Arm Specifics Section}\sethlcolor{correctioncolor}

\subsection{CFA}\label{cfa}

\subsubsection{Why?}\label{why}

\subsubsection{General Overview of the process}\label{general-overview-of-the-process}

\sethlcolor{pink}\hl{figure - CFA overview}\sethlcolor{correctioncolor}

For CFA, the general workflow has 2 separate agents, a prover (Prv) and a remote verifier (Vrf).
The Vrf sends a request to Prv with a cryptographic challenge (Eg. a \emph{nonce}).
As a response to the challenge, Prv executes the program with the given
input (either implicitly or explicitly given in the request).
It then generates a report of execution (CFreport), and sends it to Vrf.
This CFreport is signed using the challenge sent by Vrf, and contains the output of the program and an
authenticated log (CFlog) of the control flow taken by the program during execution.

\emph{But how would the Vrf know that Prv has not forged the report?}
This is where a Root of Trust (RoT) comes in.
A Root of Trust (RoT) is a part of the system that we essentially \emph{trust} to work
properly even in adversarial conditions. This trust in the mechanism is assumed and not derived.
It then serves as the foundation on which the rest of the security guarantees
of the system can be derived.

In our case, it's a piece of hardware on Prv that monitors the system, validates its state,
and generates the CFlog and CFreport that's sent to Vrf.

When Vrf recieves CFreport, it uses it to determine whether the program was executed as expected by Prv.
It does so by checking if CFlog contains a valid control flow of the program
for the input. If the path is invalid, Vrf can also analyze CFlog to detect
deviations and determine the cause.

\subsubsection{History and Techniques used}\label{history-and-techniques-used-1}

\begin{itemize}
\tightlist
\item
  History
\item
  CFLAT with technical details + limitations
\item
  OAT with improvements + limitations
\item
  \sethlcolor{pink}\hl{CFLAT and OAT had logging events for each Conditional Branch, Indirect function call, and Function exit.
  Additionally, CLFAT also had events for Unconditional Branches and Direct function calls.
  All of these events has a domain transition to TEE for logging.}\sethlcolor{correctioncolor}
\item
  Mention BLAST, just brief explaination. Link to its section.
\item
  \ldots{}
  \sethlcolor{pink}\hl{Also mention constant reporting}\sethlcolor{correctioncolor}
\end{itemize}

\section{ARM Specifics}\label{arm-specifics}

Now that we know \sethlcolor{pink}\hl{what CFI and CFA are}\sethlcolor{correctioncolor}, we can take a look at platform specific solutions.
For this work, we choose ARM as it's common in embedded applications{[}?? CITEME{]},
\sethlcolor{pink}\hl{which is a popular use-case where CFI and CFA techniques are often applied}\sethlcolor{correctioncolor}.\href{}{??}

Before diving into the implementation details, we'll first discuss the ARM ABI
(ARMv8-A specifically) and its calling conventions to brush up the required background knowledge.
We'll also discuss some architecture level features that can be used for CFI and CFA.

\subsection{ARM Assembly Basics}\label{arm-assembly-basics}

\begin{itemize}
\tightlist
\item
  Registers
\item
  Calling Conventions
\item
  Branching

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    B, B.Cond
  \item
    BL
  \item
    BLR
  \end{enumerate}
\end{itemize}

\subsection{PAC}\label{pac}

\subsection{BTI}\label{bti}

\subsection{ARM TrustZone}\label{arm-trustzone}

\sethlcolor{pink}\hl{TEE arch image Arm docs 3.1's figure}\sethlcolor{correctioncolor}

ARM TrustZone{[}?? ARMTZ{]} is Arm's security architecture in Arm A-profile architecture.
It provides 2 execution environments with hardware enforced isolation between them:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Normal World or Rich Execution Environment (REE) - It runs the regular software
  stack with a complex OS, hypervisor, etc. The attack surface is considered to be large,
  and the execution isn't trusted.
\item
  Trusted World/Execution Environment (TEE) - It runs a simple and small software
  stack which is assumed to be trusted. It has its own trusted services and OS.
  It also has a smaller attack surface due to its simplicity and size.
\end{enumerate}

There are 2 security states Arm architecture - Non-secure and Secure which map
to Rich and Trusted worlds respectively.
Exception levels are the levels of software execution privileges.
These mappings are specified in \href{}{TEE arch image}.
The states are often written with their exception levels like:

\begin{itemize}
\tightlist
\item
  \texttt{NS.EL2}: Non-secure state, Exception level 2
\item
  \texttt{S.EL2}: Secure state, Exception level 2
\end{itemize}

\emph{Note that EL3 is always in Secure State.}

\sethlcolor{pink}\hl{\texttt{smc} call convention \ldots ARMTZ docs 5.1's figure}\sethlcolor{correctioncolor}

This isolation is bridged by the usage of Secure Monitor Call (SMC) instruction.
The \texttt{smc} instruction not available in EL0 in either of the Security States.
The processes in Rich OS would call the user-space library (TEE Client),
which would in turn perform a low level call to the TrustZone driver in Rich OS.
The driver would then perform a \texttt{smc} call with arguments to the Secure Monitor.
The Secure Monitor determines the matching handler in TEE and dispatches it accordingly.

\subsection{OP-TEE}\label{op-tee}

\sethlcolor{pink}\hl{optee arch figure\ldots.arm docs 5.1.3's fig}\sethlcolor{correctioncolor}

One example of a Trusted Kernel is OP-TEE. It was developed by ST-Ericsson,
and is now an open source project maintained by Linaro.{[}?? OPTEE{]}.
The rich applications call OP-TEE Driver through TEE Client API. The Driver
is then responsible for the communication with the OP-TEE kernel.

\section{Primary Works}\label{primary-works}

\subsection{BLAST}\label{blast}

As mentioned in \sethlcolor{pink}\hl{CFA/History/CLFAT-OAT}\sethlcolor{correctioncolor}, attestation has rarely targeted whole programs.\href{}{??}
And their approaches did not scale when applied to whole program paths, mainly
due to the sheer number of domain transitions between REE/TEE.{[}?? BLAST{]}
BLAST was developed in 2023 with whole program paths in mind.
They took inspiration from program profiling literature to decrease the said overheads.

\subsubsection{How it works}\label{how-it-works}

\sethlcolor{pink}\hl{It is a LLVM pass\ldots{}}\sethlcolor{correctioncolor}

BLAST reserves 2 registers called \texttt{BLReg} and \texttt{LogReg} for the required instrumentation.

\paragraph{Local Logging:}\label{local-logging}

If we need fine-grained logging, but cannot afford the domain switches, why not log inside the REE?
BLAST does this by pre-allocating a log inside the process's address space,
and adds SFI measures \sethlcolor{pink}\hl{discussed in SFI}\sethlcolor{correctioncolor} to protect its integrity.
The log is shared between REE and TEE, and its permissions are managed by the TEE.
It is then divided in 2 halves, with each half ending with a write-protected page called \texttt{sentinel\ page}.
\texttt{LogReg} is a pointer to the head of the log, and BLAST simply adds the log entry
and increments its value.

\sethlcolor{pink}\hl{log figure}\sethlcolor{correctioncolor}

When a half is filled, \texttt{LogReg} reaches a sentinel page and a hardware fault is generated on write.
The fault handler is then executed in the TEE, which:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Makes the \texttt{LogReg} point to the other half.
\item
  Adds write-protection to the filled half, to ensure it isn't overwritten.
\item
  Commits the log's state to the TEE.
\item
  After the log is committed, it makes the half writable again.
\end{enumerate}

\paragraph{Software Fault Isolation (SFI):}\label{software-fault-isolation-sfi}

Sentinel pages are write-protected, but what about the regular log?
Although \texttt{LogReg} is reserved, and cannot be used by other parts of the code,
simple store instructions can still modify the log value. Only the instrumentation
instructions inserted as part of the BLAST pass should be allowed to append to the log.

To ensure this, BLAST adds instrumentation after each store instruction to:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Fetch the store address and the log's address.
\item
  Check that the store address doesn't lie inside the log.
\end{enumerate}

\sethlcolor{pink}\hl{sfi instrumentation figure}\sethlcolor{correctioncolor}

The log size is statically defined, and it is also aligned to that size.
i.e.~a 1MB log would be aligned to 1MB address. This makes the check equivalent
to a mask and subtract.

The reason for adding the check \emph{after} the store is to further ensure that a
CFI attack would not be able to bypass the check by jumping to the store.
The check would necessarily be run after the store, and therefore aborting the
execution if the log had been modified.

\paragraph{Optimizing log entries:}\label{optimizing-log-entries}

BLAST takes inspiration from profiling literature to place instrumentation in
an optimal fashion. It uses Ball-Larus algorithm {[}?? Ball-Larus{]} to selectively
add instrumentation to the edges of a CFG. The instrumentation manipulates the value of a counter,
which at the end of the CFG would be between \texttt{0} and \texttt{N-1}. Where \texttt{N} is the number
of acyclic paths in the CFG. This counter can be used to uniquely identify the
runtime path that was taken by the function.

This results in \texttt{2x} compact representation of paths compared to OAT's bit tracing,
and it places instrumentation at fewer locations.{[}?? BLAST{]}

\paragraph{WPP}\label{wpp}

BLAST then takes the large log, and compactly represents it using a context-free
grammar called WPP. It is an extension of Ball-Larus numbering, to build a single
control flow path through the complete program.{[}?? BLAST, ?? WPP{]}
This takes the log, that can grow upto MBs or even GBs in size, and converts into
a WPP representation that's just a few hundred bytes big.

\subsubsection{Outcome}\label{outcome}

\subsubsection{Limitations}\label{limitations}

The thread responsible of committing the log to TEE would have to run in parallel
to the program. Single core settings had an average runtime overhead of 175\%
as compared to 67\% of multi-core execution.{[}?? BLAST{]}

Reserving 2 registers may cause compatibility issues, especially with programs
that rely on inline assembly. But as shown by CFA+{[}?? CFA+{]},
\sethlcolor{pink}\hl{it is not an issue??}\sethlcolor{correctioncolor}

\subsection{CFA+}\label{cfa-1}

\subsubsection{How it works}\label{how-it-works-1}

\sethlcolor{pink}\hl{- Custom PAC
- BTI
- Logging?}\sethlcolor{correctioncolor}

\subsubsection{Outcome}\label{outcome-1}

\subsubsection{Limitations}\label{limitations-1}

\sethlcolor{pink}\hl{One of the main limitations of CFA+ is that they do not mention what's their
(logging policy)?? for attestation. They do not elaborate on whether they have
fine-grained or course-grained CFA, or even what is their logging mechanism.
The benchmarks report performance that is too good for the number of domain
switches they'd need for committing the logs in TEE.}\sethlcolor{correctioncolor}
Also, the attestation architecture diagram given indicates that the attestation
agent is triggered on BTI violation, but the \sethlcolor{pink}\hl{text..where??}\sethlcolor{correctioncolor}
mentions logs to have a violation field. The field indicates weather an entry was due to violation.
This contradiction is not addressed in their paper.\sethlcolor{pink}\hl{verify this statement}\sethlcolor{correctioncolor}

\sethlcolor{pink}\hl{rolling their own CFI which has XOR loophole (verify!)}\sethlcolor{correctioncolor}

\chapter{Extending BLAST for CFI}\label{extending-blast-for-cfi}

\minitoc 

\section{Why?}\label{why-1}

\begin{itemize}
\tightlist
\item
  \sethlcolor{pink}\hl{note on pg 2690 blast}\sethlcolor{correctioncolor}
\end{itemize}

\section{What can be done to add Integrity guarantees?}\label{what-can-be-done-to-add-integrity-guarantees}

\section{PAC + BTI gives us room to optimize BLAST}\label{pac-bti-gives-us-room-to-optimize-blast}

\section{Log Levels for control over Report Granularity}\label{log-levels-for-control-over-report-granularity}

\section{OP-TEE(delete from here?)}\label{op-teedelete-from-here}

\chapter{Evaluation}\label{evaluation}

\minitoc 

\section{Qualitative Security Analysis}\label{qualitative-security-analysis}

\section{Performance}\label{performance}

\chapter{Discussion}\label{discussion}

\minitoc 

\section{Limitations}\label{limitations-2}

\section{Why is it better than CFA+}\label{why-is-it-better-than-cfa}

\section{Future Research}\label{future-research}

\chapter*{Conclusion}\label{conclusion}
\addcontentsline{toc}{chapter}{Conclusion}

\startappendices

\chapter{The First Appendix}\label{the-first-appendix}

This first appendix includes an R chunk that was hidden in the document (using \texttt{echo\ =\ FALSE}) to help with readibility:

\textbf{In 02-rmd-basics-code.Rmd}

\textbf{And here's another one from the same chapter, i.e.~Chapter \ref{code}:}

\chapter{The Second Appendix, for Fun}\label{the-second-appendix-for-fun}

\chapter*{References}\label{references}
\addcontentsline{toc}{chapter}{References}

\markboth{References}{}

\phantomsection\label{refs}

%%%%% REFERENCES


\end{document}
